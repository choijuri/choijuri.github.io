---
layout: title
title: Cookie & Session
---

# Cookie & Session 공부



## HTTP header 구조
- Request
    - 요청라인: GET / HTTP / 1.1
    - 요청메소드 : GET, POST, PUT, DELETE
    - 요청 url
    - HTTP 버전
    - 요청헤더
    - Accept : 클라이언트가 받을 수 있는 컨텐츠
    - Cookie : 이름=값 형태로 list로 들어갈 경우 '; '(세미콜론+공백)으로 구분
               Cookie: <cookie-list>
               Cookie: name=value
               Cookie: name=value; name2=value2; name3=value3
    - Content-Type : 내가 보내는 메시지 바디 종류
    - Content-Length : 메시지 바디 길이 
    - If-Modify-Since : 특정 날짜이후에 변경되었을 때

- Response
    - 응답라인
    - 버전, 상태코드, 상태메세지
    - 응답헤더
    - Content-Type : 바디 데이터의 타입
    - Content-Length : 바디 데이터 크기
    - Set-Cookie : 쿠키 설정
    - ETag : 엔티티 태그

<br>

## 쿠키와 세션을 사용하는 이유
- HTTP 프로토콜이 connectionless, stateless한 특성을 가지기 때문 
- 클라이언트가 요청을 한 후 응답을 받으면 연결을 끊어버리기 때문에 서버와 클라이언트가 통신할 때 마다 클라이언트의 인증을 계속해야 하는 불편한 점을 해결하기 위해 사용한다.

<br>

## Cookie
- 웹 서버가 만들어 웹 브라우저에게 보내는 작은 크기의 텍스트 데이터이다. 쿠키는 클라이언트 컴퓨터에 저장되고 차후 같은 서버에 요청을 할 때 보내진다. 쿠키는 하나의 이름과 값을 가지며 유효 시간, 경로 및 도메인 등과 같은 추가 정보를 가질 수 있다.

- 이름 : 각각의 쿠키를 구별하는 데 사용되는 이름이다.
- 값 : 쿠키의 이름과 관련된 값이다.
- 유효기간 : 클라이언트에서 쿠키가 저장된 후, 보관되는 기간이다. 유효 시간이 지난 쿠키는 웹 브라우저에 의해 삭제된다. 유효 시간이 0인 쿠키는 바로 삭제된다. 유효 시간의 기본 값은 –1이며 이 경우 쿠키는 웹 브라우저가 종료될 때 삭제된다.
- 도메인 : 기본적으로 쿠키는 그것을 보내 준 서버에게 요청할 때만 클라이언트로부터 전송된다. 쿠키의 도메인 설정을 통해 같은 도메인 상에 있는 다른 서버들이 쿠키를 공유할 수도 있다.
- 경로 : 클라이언트가 서버에게 요청을 할 때, 쿠키에 설정된 경로와 그것의 하위 경로에 있는 페이지를 요청할 때만 쿠키가 전송된다. 쿠키에 경로를 지정하지 않으면 기본적으로 쿠키를 만들어 보낸 페이지의 경로와 그 하위 경로에 쿠키가 보내질 수 있다.
- Secure : https에서만 쿠키가 전송된다.
- HttpOnly : 자바스크립트에서 쿠키에 접근할 수 없습니다. XSS 요청을 막으려면 활성화해두는 것이 좋다.


#### <쿠키 동작 방식>
1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성
3. HTTP 헤더에 쿠키를 포함 시켜 응답
4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경 할 필요가 있을 때 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

<br>

## SESSION
- 쿠키를 기반으로 사용자정보파일을 브라우저에 저장하는 쿠키와 달리, 서버측에서 관리한다. 
- 서버에서 클라이언트를 구분하기 위해 세션ID를 부여하여 웹브라우저가 서버에 접속해서 종료 할 때까지 인증상태를 유지한다. 
- 사용자에 대한 정보를 서버에 두기 때문에 비교적 보안에 좋지만, 사용자가 많아 질 수록 서버 메모리를 사용하기 떄문에 동시 접속자가 많은 웹사이트인 경우 성능저하의 요인이 될 수 있다.
- 클라이언트가 request를 보내면 서버엔진이 클라이언트에게 유일한 sessionID가 부여한다.

#### <세션 동작 방식>
1. 클라이언트가 서버 접속 시 세션ID를 발급
2. 클라이언트는 세션 ID를 쿠키를 사용해서 저장 
3. 클라이언트가 서버에 다시 접속 시 쿠키를 사용하여 세션 ID값을 서버에 전달





<br>

## 쿠키와 세션의 차이
- 사용자의 기록정보가 저장되는 위치 
 쿠키는 서버의 자원을 전혀 사용하지 않지만 세션은 서버의 자원을 사용한다.
- 요청속도는 쿠키가 더 빠르다 
 세션은 서버의 처리가 필요하기 때문
- 보안은 비교적으로 세션이 우수하다.
쿠키는 클라이언트 로컬에 저장되기 때문에 변질되거나 request에서 스나이핑 당할 우려가 있어서 보안에 취약하지만 세션은 쿠키를 이용해서 sessionid 만 저장하고 그것으로 구분해서 서버에서 처리하기 때문에 비교적 보안성이 좋다.
- 라이프사이클
 쿠키는 만료시간이 있지만 파일로 저장되기 떄문에 브라우저를 종료해도 계속 정보가 남을 수 있다.
 세션은 만료시간을 정할 수 있지만 이것에 상관없이 브라우저가 종료되면 삭제된다.

<br>

#### 참고
-  <https://booolean.tistory.com/509> 
- <https://interconnection.tistory.com/74> 
- <https://www.zerocho.com/category/HTTP/post/5b594dd3c06fa2001b89feb9> 
